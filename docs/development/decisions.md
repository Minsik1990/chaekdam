# 기술 결정 기록 (Architecture Decision Records)

> 주요 기술 결정과 그 근거를 기록합니다.

---

## ADR-001: Next.js 15 App Router 채택

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: Next.js 15 (App Router)를 프론트엔드/풀스택 프레임워크로 사용
- **근거**:
  - Vercel과 최적 통합 (자동 배포, Preview, 이미지 최적화)
  - React Server Components로 성능 최적화
  - App Router가 안정화되어 프로덕션 사용 가능
  - Supabase 공식 템플릿 제공
  - 풍부한 생태계 (shadcn/ui, Tailwind 등)
- **대안 검토**:
  - Remix: Vercel 통합 약함, 커뮤니티 규모 작음
  - Nuxt: Vue 생태계 (React 대비 UI 라이브러리 적음)
  - SvelteKit: 생태계 아직 성숙하지 않음

---

## ADR-002: Supabase 선택

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: Supabase를 Backend-as-a-Service로 사용
- **근거**:
  - PostgreSQL 기반 관계형 DB (독서 기록/모임 데이터에 적합)
  - Auth, Storage, Realtime, Edge Functions 통합 제공
  - 무료 티어가 넉넉 (500MB DB, 50K MAU)
  - MCP 서버로 자연어 스키마 설계 가능
  - 타입 자동 생성 (`supabase gen types`)
- **대안 검토**:
  - Firebase: NoSQL 구조가 관계형 데이터에 부적합
  - PlanetScale: Auth, Storage 별도 구성 필요
  - Neon: DB만 제공 (Auth, Storage 없음)
- **주의사항**:
  - 7일 비활성 시 자동 일시정지 -> cron job으로 방지
  - Storage 1GB 한계 (MVP 범위에서 충분)

---

## ADR-003: Claude API 선택

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: Claude Sonnet 4.5 단일 모델로 AI 에이전트 운영
- **근거**:
  - 문학 분석, 발제문 생성 등 핵심 기능에 충분한 품질 필요
  - 한국어 성능 우수 (감성 대화, 따뜻한 톤 유지)
  - Prompt Caching으로 비용 90% 절감 가능
  - 스트리밍 응답 지원
  - 모델 라우팅 로직 제거 -> 복잡도 최소화
- **비용 예상**:
  - Sonnet $3/$15 per 1M tokens
  - 10명 모임 기준: ~$3/월 (약 4,000원), Prompt Caching 적용 시 더 절감

---

## ADR-004: shadcn/ui 채택

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: shadcn/ui를 UI 컴포넌트 라이브러리로 사용
- **근거**:
  - 복사-붙여넣기 방식 -> 완전한 커스터마이징
  - Radix UI 기반 접근성 보장
  - Tailwind CSS와 완벽 호환
  - 번들 사이즈 최적화 (사용하는 컴포넌트만 포함)
- **대안 검토**:
  - MUI: 무겁고, 커스터마이징 어려움
  - Ant Design: 중국풍 디자인
  - Chakra UI: 번들 무거움

---

## ADR-005: Spec-Driven Development 방법론

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: Spec-Driven + AI-First 개발 방법론 채택
- **근거**:
  - Addy Osmani의 2026 LLM 코딩 워크플로우 기반
  - "Explore -> Plan -> Implement -> Verify -> Commit" 5단계
  - PRD를 AI가 소비 가능한 형식으로 작성
  - 솔로 개발자 + Claude Code 조합에 최적화

---

## ADR-006: CLAUDE.md 간결화 원칙

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: CLAUDE.md를 50-100줄로 유지, 상세는 docs/ 포인터
- **근거**:
  - 모든 단어가 컨텍스트 토큰 소비 -> 간결할수록 AI 성능 향상
  - WHY > WHAT 원칙
  - CRITICAL 키워드로 핵심 제약 강조

---

## ADR-007: Cloudflare R2 (이미지 저장)

- **날짜**: 2026-02-07
- **상태**: ~~확정~~ -> **폐기 (v2.0-alpha)**
- **결정**: ~~모임 사진 저장에 Cloudflare R2 사용~~ -> Supabase Storage 사용
- **폐기 이유**: v2에서 이미지 업로드가 Phase 2로 이동. Supabase Storage(1GB)로 MVP 충분. 별도 인프라 추가 불필요.

---

## ADR-008: Public GitHub 레포

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: GitHub 레포를 Public으로 운영
- **근거**:
  - GitHub Actions 무제한 사용 (Private은 2,000분/월)
  - 비밀 키는 Vercel 환경 변수로 관리
- **주의사항**:
  - `.env` 파일 절대 커밋 금지
  - `.gitignore`에 민감 파일 포함

---

## ADR-009: MVP 초대 코드 인증

- **날짜**: 2026-02-07
- **상태**: ~~확정~~ -> **대체 (v2.0-alpha, ADR-010)**
- **결정**: ~~초대 코드 + 닉네임 (쿠키 기반)~~ -> Magic Link + 초대 코드 (DB 기반)
- **대체 이유**: v2에서 Supabase Auth Magic Link로 전환. 초대 코드는 가입 제한 용도로 유지하되, DB 테이블(invite_codes)로 관리.

---

## ADR-010: Magic Link 인증 선택

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: Supabase Auth Magic Link (이메일)를 인증 방식으로 채택
- **근거**:
  - **카카오 OAuth 배제 이유**: 개인정보처리방침 작성 의무, 사업자등록증 필요(선택), 앱 심사 과정 등 소규모 독서 모임 서비스에 과한 부담
  - Magic Link는 비밀번호 없이 이메일만으로 로그인 -> 최소한의 마찰
  - Supabase Auth에 내장되어 별도 설정 최소화
  - 초대 코드(invite_codes 테이블)로 가입 제한 유지 가능
  - 향후 Phase 3에서 카카오/구글 OAuth 추가 용이
- **대안 검토**:
  - 카카오 OAuth: 개인정보처리방침 부담, 심사 시간
  - 비밀번호 로그인: 비밀번호 분실/찾기 관리 부담
  - 초대 코드 + 쿠키 (v1): 사용자 식별 불가, 기기 변경 시 데이터 유실

---

## ADR-011: 따뜻한 토스 디자인 시스템

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: 밍들레씨 캐릭터 테마를 제거하고, 따뜻한 토스 스타일 디자인 시스템으로 전환
- **근거**:
  - 밍들레씨 캐릭터 테마(그린/노랑/핑크)가 "독서 기록" 서비스에 과하게 캐릭터 의존적
  - 코랄(#F4845F) 포인트 + 깔끔한 미니멀 디자인이 개인 기록 서비스에 적합
  - 토스의 검증된 UX 패턴 (하단 탭, 카드 레이아웃, 타이포 중심) 활용
  - 캐릭터 에셋 제작 부담 제거 -> 개발 속도 향상
  - 라이트 모드 전용으로 범위 축소 -> 복잡도 감소
- **변경 내용**:
  - Primary: #7CB342 (그린) -> #F4845F (코랄)
  - Accent: #FFD54F (노랑) -> #FFB74D (앰버)
  - 캐릭터 일러스트 -> Lucide 아이콘
  - 밍들레씨 톤의 카피 -> 깔끔한 안내 문구

---

## ADR-012: 개인 기록 중심 전환

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: 서비스 핵심을 "독서 모임"에서 "개인 독서 기록"으로 전환
- **근거**:
  - 독서 모임은 참여자 수에 의존하여 초기 가치 제공이 어려움 (cold start)
  - 개인 기록은 혼자서도 즉시 가치를 느낄 수 있음
  - "기록" -> "모임" 순서가 자연스러운 사용자 여정
  - 경쟁 서비스(Repov, 북적북적) 분석 결과 개인 기록이 핵심 사용 동기
  - 독서 모임은 Phase 1에서 기본 기능만 제공하고, 점진적으로 강화
- **변경 내용**:
  - 홈 화면: 모임 목록 -> 내 기록 피드
  - 하단 탭 중앙: "+기록" 버튼 (가장 중요한 액션)
  - records 테이블 신설 (content, quote, rating, status, card_color)
  - 대화형 기록(AI Interview) 기능 추가

---

## ADR-013: AI 도구형 전환

- **날짜**: 2026-02-07
- **상태**: 확정
- **결정**: AI 에이전트를 캐릭터 페르소나("밍들레")에서 도구형 조력자로 전환
- **근거**:
  - 캐릭터 페르소나가 AI 응답의 전문성을 약화시킬 수 있음
  - 도구형 조력자가 "요약", "토론 주제", "발제문 초안" 등 명확한 기능에 적합
  - 캐릭터 톤 유지를 위한 복잡한 시스템 프롬프트 불필요 -> 비용 절감
  - 기능별 전용 엔드포인트 분리로 캐싱 효율 향상
  - 사용자가 "어떤 기능을 쓸 수 있는지" 명확히 인지 가능
- **변경 내용**:
  - `/api/agent/chat` (자유 대화) 삭제
  - `/api/agent/interview`, `/summarize`, `/topics`, `/draft`, `/analysis` 분리
  - 시스템 프롬프트: 캐릭터 성격 -> 기능 지시 ("~입니다", "~드립니다" 톤)
  - 채팅 UI -> AgentPanel (기능 선택 -> 결과 표시)
